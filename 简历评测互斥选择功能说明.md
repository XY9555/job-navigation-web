# 简历评测互斥选择功能说明

## 功能概述

为了避免用户在简历评测时出现"选择的简历和上传的简历不一致"的问题，我们实现了互斥选择机制，确保用户只能选择一种评测方式。

## 功能特性

### 1. 互斥选择机制 ✅
- **选择已有简历** 和 **上传新文件** 两种方式互斥
- 选择其中一种方式后，另一种方式自动禁用
- 提供清晰的视觉反馈和状态指示

### 2. 状态指示 ✅
- **模式徽章**: 显示当前选择状态
  - 🟢 "已选择" - 当前激活的方式
  - 🟡 "已禁用" - 被禁用的方式
- **动态按钮文本**: 根据选择方式显示不同的按钮文本
- **提示信息**: 引导用户正确操作

### 3. 重置功能 ✅
- **重置按钮**: 允许用户清空当前选择，重新选择
- **自动清理**: 切换方式时自动清理相关数据
- **状态恢复**: 重置后回到初始状态

## 用户交互流程

### 方式一：选择已有简历
1. **选择简历** → 下拉框选择已有简历
2. **状态变化** → 上传区域变为禁用状态
3. **开始评测** → 点击"评测选中简历"按钮

### 方式二：上传新文件
1. **上传文件** → 点击上传区域选择文件
2. **状态变化** → 简历选择下拉框变为禁用状态
3. **文件解析** → 自动解析文件内容
4. **开始评测** → 点击"评测上传文件"按钮

### 重新选择
1. **点击重置** → 点击当前选择旁的重置按钮
2. **状态清空** → 所有选择被清空
3. **重新选择** → 可以重新选择任一方式

## 界面元素

### 1. 选择简历区域
```
选择已有简历 [已选择] / [已禁用]
┌─────────────────────────┐
│ 请选择简历 ▼            │ (禁用时变灰)
└─────────────────────────┘
```

### 2. 上传文件区域
```
上传新简历 [已选择] / [已禁用]
┌─────────────────────────┐
│ 📄 上传简历文件          │ (禁用时显示提示)
│    支持PDF、Word文档     │
└─────────────────────────┘
```

### 3. 当前选择状态
```
┌─────────────────────────┐
│ 📋 已选择简历            │ 🔄
│    前端开发工程师简历    │
└─────────────────────────┘
```

### 4. 评测按钮
- `请选择评测方式` (未选择时)
- `评测选中简历` (选择简历时)
- `评测上传文件` (上传文件时)
- `AI评测中...` (评测进行时)

## 技术实现

### 1. 状态管理
```javascript
data() {
  return {
    evaluationMode: '', // 'select' 或 'upload'
    selectedResume: '',
    uploadedFile: null,
    // ...
  }
}
```

### 2. 计算属性
```javascript
computed: {
  canEvaluate() {
    const hasValidSelection = 
      (this.evaluationMode === 'select' && this.selectedResume) || 
      (this.evaluationMode === 'upload' && this.uploadedFile);
    return hasValidSelection && Object.values(this.evaluationOptions).some(option => option);
  },
  
  evaluationButtonText() {
    if (this.loading) return 'AI评测中...';
    if (this.evaluationMode === 'select') return '评测选中简历';
    if (this.evaluationMode === 'upload') return '评测上传文件';
    return '请选择评测方式';
  }
}
```

### 3. 方法实现
```javascript
methods: {
  selectResume(resumeId) {
    this.evaluationMode = 'select';
    this.selectedResume = resumeId;
    this.uploadedFile = null;
    this.parsedContent = null;
  },
  
  handleFile(file) {
    this.evaluationMode = 'upload';
    this.uploadedFile = file;
    this.selectedResume = '';
    this.parsedContent = null;
  },
  
  resetSelection() {
    this.evaluationMode = '';
    this.selectedResume = '';
    this.uploadedFile = null;
    this.parsedContent = null;
  }
}
```

## 评测逻辑

### 1. 选择简历评测
- 直接调用后端API: `aiAPI.evaluateResume(resumeId)`
- 使用数据库中的简历数据

### 2. 上传文件评测
- 先解析文件内容（如果未解析）
- 创建临时简历对象
- 直接调用AI服务进行评测
- 不保存到数据库

### 3. 结果处理
- 统一的结果格式
- 添加评测来源信息
- 跳转到结果页面

## 用户体验优化

### 1. 视觉反馈
- ✅ 清晰的状态指示
- ✅ 禁用状态的视觉区分
- ✅ 动态按钮文本
- ✅ 友好的提示信息

### 2. 操作便利性
- ✅ 一键重置功能
- ✅ 自动状态切换
- ✅ 智能提示引导

### 3. 错误预防
- ✅ 互斥选择机制
- ✅ 状态验证
- ✅ 操作确认

## 测试用例

### 1. 基本功能测试
- [ ] 选择简历后上传区域被禁用
- [ ] 上传文件后选择框被禁用
- [ ] 重置按钮清空所有状态
- [ ] 按钮文本正确显示

### 2. 评测功能测试
- [ ] 选择简历模式评测正常
- [ ] 上传文件模式评测正常
- [ ] 评测结果正确显示来源信息

### 3. 边界情况测试
- [ ] 未选择任何方式时按钮禁用
- [ ] 切换方式时数据正确清理
- [ ] 网络错误时状态正确恢复

## 总结

通过实现互斥选择机制，我们成功解决了用户可能遇到的简历选择混淆问题：

1. **明确的操作流程** - 用户只能选择一种评测方式
2. **清晰的状态反馈** - 实时显示当前选择状态
3. **灵活的重置功能** - 支持重新选择
4. **统一的评测体验** - 两种方式都能获得完整的评测结果

这样的设计确保了用户体验的一致性和操作的明确性，避免了选择冲突的问题。