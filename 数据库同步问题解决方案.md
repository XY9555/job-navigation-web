# æ•°æ®åº“åŒæ­¥é—®é¢˜è§£å†³æ–¹æ¡ˆ

## é—®é¢˜æè¿°

åœ¨å¯åŠ¨åç«¯æœåŠ¡æ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š
```
âŒ æ•°æ®åº“è¡¨åŒæ­¥å¤±è´¥: Validation error
```

## é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 
1. **å¤‡ä»½è¡¨å†²çª**: Sequelizeåœ¨æ‰§è¡Œ`alter: true`åŒæ­¥æ—¶åˆ›å»ºäº†å¤‡ä»½è¡¨`users_backup`
2. **å”¯ä¸€çº¦æŸå†²çª**: åœ¨å°†æ•°æ®ä»åŸè¡¨å¤åˆ¶åˆ°å¤‡ä»½è¡¨æ—¶é‡åˆ°IDé‡å¤é—®é¢˜
3. **å¤–é”®çº¦æŸ**: è¡¨ä¹‹é—´çš„å¤–é”®å…³ç³»é˜»æ­¢äº†è¡¨çš„åˆ é™¤å’Œé‡å»º

### å…·ä½“é”™è¯¯
```
SQLITE_CONSTRAINT: UNIQUE constraint failed: users_backup.id
SQLITE_CONSTRAINT: FOREIGN KEY constraint failed
```

## è§£å†³æ­¥éª¤

### 1. é—®é¢˜è¯Šæ–­ âœ…
åˆ›å»ºäº†`diagnose-database.js`è„šæœ¬æ¥åˆ†æé—®é¢˜ï¼š
- æ£€æŸ¥æ•°æ®ç›®å½•å’Œæ–‡ä»¶æƒé™
- æµ‹è¯•æ•°æ®åº“è¿æ¥
- æ£€æŸ¥ç°æœ‰è¡¨ç»“æ„
- å‘ç°å¤‡ä»½è¡¨å†²çª

### 2. å°è¯•ä¿®å¤ âš ï¸
åˆ›å»ºäº†`fix-database.js`è„šæœ¬ï¼š
- åˆ é™¤å¤‡ä»½è¡¨
- é‡æ–°åŒæ­¥æ¨¡å‹
- é‡åˆ°å¤–é”®çº¦æŸé—®é¢˜

### 3. å½»åº•é‡ç½® âœ…
åˆ›å»ºäº†`reset-database.js`è„šæœ¬ï¼š
- åœæ­¢åç«¯æœåŠ¡é‡Šæ”¾æ•°æ®åº“é”
- åˆ é™¤æ•´ä¸ªæ•°æ®åº“æ–‡ä»¶
- é‡æ–°åˆ›å»ºæ•°æ®åº“å’Œè¡¨ç»“æ„
- æ’å…¥æµ‹è¯•æ•°æ®

## æŠ€æœ¯ç»†èŠ‚

### æ•°æ®åº“é…ç½®æ”¹è¿›
```javascript
// æ”¹è¿›çš„åŒæ­¥æ–¹æ³•
async function syncDatabase() {
  try {
    console.log('ğŸ”„ å¼€å§‹åŒæ­¥æ•°æ®åº“è¡¨...');
    
    await sequelize.sync({ 
      alter: true,
      logging: (sql) => {
        console.log('ğŸ“ SQL:', sql);
      }
    });
    
    console.log('âœ… æ•°æ®åº“è¡¨åŒæ­¥å®Œæˆ');
  } catch (error) {
    console.error('âŒ æ•°æ®åº“è¡¨åŒæ­¥å¤±è´¥:', error.message);
    
    // å¼€å‘ç¯å¢ƒä¸‹å°è¯•å¼ºåˆ¶é‡å»º
    if (process.env.NODE_ENV === 'development') {
      await sequelize.sync({ force: true });
    }
  }
}
```

### æ¨¡å‹å®šä¹‰ä¼˜åŒ–
- ç¡®ä¿æ‰€æœ‰å­—æ®µç±»å‹æ­£ç¡®
- æ·»åŠ é€‚å½“çš„éªŒè¯è§„åˆ™
- æ­£ç¡®å®šä¹‰å…³è”å…³ç³»

### æµ‹è¯•æ•°æ®åˆ›å»º
```javascript
// åˆ›å»ºå®Œæ•´çš„æµ‹è¯•æ•°æ®
const testUser = await User.create({
  phone: '13800138000',
  password: '123456',
  name: 'æµ‹è¯•ç”¨æˆ·',
  email: 'test@example.com'
});

const testResume = await Resume.create({
  userId: testUser.id,
  title: 'å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆç®€å†',
  personalInfo: { /* å®Œæ•´ä¿¡æ¯ */ },
  // ... å…¶ä»–å­—æ®µ
});
```

## é¢„é˜²æªæ–½

### 1. æ•°æ®åº“å¤‡ä»½
```bash
# å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶
cp backend/data/database.sqlite backend/data/database.backup.sqlite
```

### 2. ç¯å¢ƒå˜é‡é…ç½®
```bash
# åœ¨.envæ–‡ä»¶ä¸­è®¾ç½®
NODE_ENV=development
```

### 3. æ¸è¿›å¼è¿ç§»
- é¿å…å¤§å¹…åº¦ä¿®æ”¹è¡¨ç»“æ„
- ä½¿ç”¨è¿ç§»è„šæœ¬è€Œä¸æ˜¯ç›´æ¥sync
- åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è°¨æ…ä½¿ç”¨`alter: true`

### 4. ç›‘æ§å’Œæ—¥å¿—
```javascript
// å¯ç”¨SQLæ—¥å¿—
const sequelize = new Sequelize({
  // ...
  logging: process.env.NODE_ENV === 'development' ? console.log : false
});
```

## å·¥å…·è„šæœ¬

### 1. è¯Šæ–­è„šæœ¬
```bash
node backend/diagnose-database.js
```
- æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
- åˆ†æè¡¨ç»“æ„
- æµ‹è¯•è¿æ¥å’Œæƒé™

### 2. ä¿®å¤è„šæœ¬
```bash
node backend/fix-database.js
```
- æ¸…ç†å¤‡ä»½è¡¨
- å°è¯•ä¿®å¤åŒæ­¥é—®é¢˜

### 3. é‡ç½®è„šæœ¬
```bash
node backend/reset-database.js
```
- å®Œå…¨é‡å»ºæ•°æ®åº“
- åˆ›å»ºæµ‹è¯•æ•°æ®
- é€‚ç”¨äºå¼€å‘ç¯å¢ƒ

## æœ€ç»ˆç»“æœ

### è§£å†³æ•ˆæœ âœ…
- âœ… æ•°æ®åº“åŒæ­¥æˆåŠŸ
- âœ… è¡¨ç»“æ„æ­£ç¡®åˆ›å»º
- âœ… æµ‹è¯•æ•°æ®å®Œæ•´
- âœ… æœåŠ¡æ­£å¸¸å¯åŠ¨

### å¯åŠ¨æ—¥å¿—
```
ğŸ“ SQL: CREATE INDEX `resumes_user_id` ON `resumes` (`userId`)
ğŸ“ SQL: CREATE INDEX `resumes_status` ON `resumes` (`status`)
âœ… æ•°æ®åº“è¡¨åŒæ­¥å®Œæˆ
âœ… SQLiteæ•°æ®åº“åˆå§‹åŒ–å®Œæˆ
ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£ 3000
```

### æ•°æ®éªŒè¯
- ğŸ‘¥ ç”¨æˆ·æ•°é‡: 1
- ğŸ“„ ç®€å†æ•°é‡: 2
- ğŸ”‘ æµ‹è¯•è´¦å·: 13800138000 / 123456

## ç»éªŒæ€»ç»“

### é—®é¢˜æ ¹æº
1. **Sequelizeçš„alteræœºåˆ¶**: åœ¨ä¿®æ”¹è¡¨ç»“æ„æ—¶ä¼šåˆ›å»ºå¤‡ä»½è¡¨
2. **æ•°æ®ä¸€è‡´æ€§**: å¤‡ä»½è¡¨ä¸­çš„æ•°æ®å¯èƒ½ä¸åŸè¡¨å†²çª
3. **å¤–é”®çº¦æŸ**: SQLiteçš„å¤–é”®æ£€æŸ¥é˜»æ­¢äº†è¡¨çš„åˆ é™¤

### è§£å†³æ€è·¯
1. **è¯Šæ–­ä¼˜å…ˆ**: å…ˆäº†è§£é—®é¢˜çš„å…·ä½“åŸå› 
2. **æ¸è¿›ä¿®å¤**: ä»ç®€å•åˆ°å¤æ‚çš„ä¿®å¤æ–¹æ¡ˆ
3. **å½»åº•é‡ç½®**: åœ¨å¼€å‘ç¯å¢ƒä¸­å¯ä»¥é€‰æ‹©é‡å»º
4. **é¢„é˜²ä¸ºä¸»**: å»ºç«‹è‰¯å¥½çš„æ•°æ®åº“ç®¡ç†æµç¨‹

### æœ€ä½³å®è·µ
1. **å¼€å‘ç¯å¢ƒ**: å¯ä»¥ä½¿ç”¨`force: true`é‡å»ºè¡¨
2. **ç”Ÿäº§ç¯å¢ƒ**: ä½¿ç”¨è¿ç§»è„šæœ¬è¿›è¡Œç»“æ„å˜æ›´
3. **å¤‡ä»½ç­–ç•¥**: å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶
4. **ç›‘æ§æ—¥å¿—**: å¯ç”¨SQLæ—¥å¿—ä¾¿äºè°ƒè¯•

é€šè¿‡è¿™æ¬¡é—®é¢˜è§£å†³ï¼Œæ•°æ®åº“ç°åœ¨è¿è¡Œç¨³å®šï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½èƒ½æ­£å¸¸ä½¿ç”¨ã€‚